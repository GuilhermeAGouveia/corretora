// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Pessoa {
  id        String     @id @default(cuid())
  firstName String
  lastName  String
  email     String
  address   String
  city      String
  state     String
  cep       String
  phones    Telefone[]
  createdAt DateTime   @default(now())
  Locador   Locador?
  Locatario Locatario?
  Corretor  Corretor?
}

model Telefone {
  numero   String
  idPessoa String

  pessoa Pessoa @relation(fields: [idPessoa], references: [id], onDelete: Cascade)

  @@id([numero, idPessoa], name: "idTelefone")
}

model Locador {
  cod_lcd    String             @id
  is_partner Boolean
  pessoa     Pessoa             @relation(fields: [cod_lcd], references: [id], onDelete: Cascade)
  imovel     Imovel[]
  contratos  Corretor_Locador[]
}

model Locatario {
  cod_lct    String      @id
  birthdate  DateTime
  pessoa     Pessoa      @relation(fields: [cod_lct], references: [id], onDelete: Cascade)
  associados Associado[]
  contrato   Contrato[]
}

model Corretor {
  cod_cor         String             @id
  score           Int                @default(0)
  pessoa          Pessoa             @relation(fields: [cod_cor], references: [id], onDelete: Cascade)
  corretorLocador Corretor_Locador[]
  contrato        Contrato[]
}

model Imovel {
  cod_imv String     @id @default(cuid())
  cod_lcd String // dono (Locador)        
  type    ImovelType @default(CASA)

  // Endereço

  address  String
  cep      String
  district String
  city     String
  state    String
  nApto    Int?

  // Descrição do imóvel

  hasGarage   Boolean        @default(false)
  hasGarden   Boolean        @default(false)
  hasSuite    Boolean        @default(false)
  nRooms      Int            @default(0)
  nBathrooms  Int            @default(0)
  area        Float          @default(0)
  isFurnished LevelFurnished @default(NONE)
  supDescribe String? // Descrição complementar

  price       Float?
  mensalidade Float?
  createdAt   DateTime @default(now())

  locador      Locador         @relation(fields: [cod_lcd], references: [cod_lcd], onDelete: Restrict)
  regrasImovel Regras_Imovel[]
  contratos    Contrato[]
  images       Image[]
}

enum LevelFurnished {
  FULL
  SEMI
  NONE
}

enum ImovelType {
  CASA
  APTO
}

model Regras_Imovel {
  cod_imv  String
  regra    String
  imovel   Imovel        @relation(fields: [cod_imv], references: [cod_imv], onDelete: Cascade)
  priority Rule_Priority @default(NORMAL)

  @@id([cod_imv, regra], name: "idRegra")
}

enum Rule_Priority {
  IMPORTANT
  DESIRABLE // Desejável
  NORMAL
}

// Contrato entre corretor e locador
model Corretor_Locador {
  cod_cor    String
  cod_lcd    String
  commission Float    @default(0)
  createdAt  DateTime @default(now())
  locador    Locador  @relation(fields: [cod_lcd], references: [cod_lcd], onDelete: Restrict)
  corretor   Corretor @relation(fields: [cod_cor], references: [cod_cor], onDelete: Restrict)

  @@id([cod_cor, cod_lcd], name: "idCorretorLocador")
}

model Associado {
  name      String
  cod_lct   String
  birthdate DateTime?
  tipo      AssociadoType @default(OUTRO)
  locatario Locatario     @relation(fields: [cod_lct], references: [cod_lct], onDelete: Cascade)

  @@id([name, cod_lct], name: "idAssociado")
}

enum AssociadoType {
  CONJUGE
  FILHO
  IRMAO
  PAI
  MAE
  OUTRO
}

model Contrato {
  cod_cor String
  cod_imv String
  cod_lct String

  dateInit DateTime?
  dateEnd  DateTime?

  type ContratoType @default(LOCACAO)

  createdAt DateTime @default(now())

  corretor  Corretor  @relation(fields: [cod_cor], references: [cod_cor], onDelete: Restrict)
  imovel    Imovel    @relation(fields: [cod_imv], references: [cod_imv], onDelete: Restrict)
  locatario Locatario @relation(fields: [cod_lct], references: [cod_lct], onDelete: Restrict)

  @@id([cod_cor, cod_imv, cod_lct], name: "idContrato")
}

enum ContratoType {
  LOCACAO
  VENDA
}

model Image {
  idOwner String
  url       String
  createdAt DateTime @default(now())
  imovel    Imovel   @relation(fields: [idOwner], references: [cod_imv], onDelete: Cascade) 

  @@id([idOwner, url], name: "idImage")
}
